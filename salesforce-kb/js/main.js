var instance_url=sessionStorage.getItem('sf_instance_url')||'',access_token=sessionStorage.getItem('sf_access_token')||'';const TITLE_MAX_LENGTH=200;var nextPageUrl='',selectedArticleContent='',client_id='3MVG9Y6d_Btp4xp72W9.4z8aEmqObeZeBZYeC2DeUoNidqw8Ixssf2xUW2RwE4IncbPz.nk3CCzF16QTy65Ye',consumer_secret='8536171724459418589',callback_url=window.location.origin+'/LiveChat/SalesforceLoginTransfer.html',restAPIVersion='v41.0',scrollTop=0;const STATUS={LOADING:'status-loading',LOGIN:'status-login',LISTVIEW:'status-list-view',DETAILVIEW:'status-detail-view'};(function(){function a(y){return document.getElementById(y)}function b(y){var z=a(y);z&&(z.style.display='block')}function c(y){var z=a(y);z&&(z.style.display='none')}function d(y){var z=a(y);z&&z.classList.add('disabled')}function f(y){var z=a(y);z&&z.classList.remove('disabled')}function g(y){var z=a('main');z.className=y,c('searchMsg')}function h(){g(STATUS.LOADING);j()&&(k(),s())}function j(){x=new SFAuthContext({popUp:!0,callback:function(){g(STATUS.LOGIN),h()},onError:function(A){a('error').innerText=A,b('error')},client_id:client_id,consumer_secret:consumer_secret,callback_url:callback_url}),a('connect').addEventListener('click',function(){x.login()});var z=x.isCallback(window.location.hash);if(z&&x.handleWindowCallback(),''!==x._getItem(x.CONSTANTS.INSTANCE_URL)&&''!==x._getItem(x.CONSTANTS.ACCESS_TOKEN)&&''!==x._getItem(x.CONSTANTS.REFRESH_TOKEN))g(STATUS.LISTVIEW);else return g(STATUS.LOGIN),!1;return!0}function k(){b('dataLoading');var y=x._getItem(x.CONSTANTS.INSTANCE_URL)+`/services/data/${restAPIVersion}/support/knowledgeArticles`;t(y,function(z,A){if(200===z){var B=A.articles;nextPageUrl=A.nextPageUrl,nextPageUrl?f('moreBtn'):d('moreBtn'),m(B),g(STATUS.LISTVIEW),c('searchMsg'),b('articles'),c('dataLoading')}})}function l(y,z){var A=encodeURI(x._getItem(x.CONSTANTS.INSTANCE_URL)+`/services/data/${restAPIVersion}/support/knowledgeArticles/`+y);t(A,function(B,C){200===B?o(C):C&&w(z,B,C)})}function m(y){if(0===y.length)return void(a('articles').innerHTML='<span class="noRecords">No articles found.</span>');for(var B,z='',A=0;A<y.length;A++)B=y[A].summary||y[A].Summary||'',z+='<li data-id="'+(y[A].id||y[A].Id)+'">\t\t\t<h3 class="ext-font-title">'+(y[A].title||y[A].Title)+'</h3>\t\t\t<p class="ext-font-artical">'+(B.length>=TITLE_MAX_LENGTH?B.substr(0,TITLE_MAX_LENGTH)+'...':B)+'</p>\t\t\t</li>';a('articles').innerHTML=z}function n(y){if(0!==y.length){for(var B,z='',A=0;A<y.length;A++)B=y[A].summary||y[A].Summary||'',z+='<li data-id="'+(y[A].id||y[A].Id)+'">\t\t\t<h3 class="ext-font-title">'+(y[A].title||y[A].Title)+'</h3>\t\t\t<p class="ext-font-artical">'+(B.length>=TITLE_MAX_LENGTH?B.substr(0,TITLE_MAX_LENGTH)+'...':B)+'</p>\t\t\t</li>';var C=document.createElement('div');C.innerHTML=z,a('articles').appendChild(C)}}function o(y){var z=!1;if(a('detailTitle').innerHTML=y.title,y.layoutItems)for(let A=0;A<y.layoutItems.length;++A)if('Internal'===y.layoutItems[A].label&&y.layoutItems[A].value){selectedArticleContent=r(y.layoutItems[A].value),a('detailContent').innerHTML=selectedArticleContent,z=!0,f('insertBtn');break}z||(a('detailContent').innerHTML='',d('insertBtn')),g(STATUS.DETAILVIEW),scrollTo(0,0)}function r(y){return y=y.replace(/src="([^"]*)"/g,function(z,A){return A.startsWith('http://')||A.startsWith('https://')||(z=z.replace(A,x._getItem(x.CONSTANTS.INSTANCE_URL)+A)),z}),y=y.replace(/href="([^"]*)"/g,function(z,A){return A.startsWith('http://')||A.startsWith('https://')||(z=z.replace(A,x._getItem(x.CONSTANTS.INSTANCE_URL)+A)),z}),y}function s(){a('connect').addEventListener('click',function(){x.login()}),a('articles').addEventListener('click',function(y){var A,z=y.target||y.srcElement;if('LI'===z.parentNode.parentNode.nodeName&&(A=z.parentNode.parentNode.getAttribute('data-id')),'H3'===z.nodeName){scrollTop=window.document.scrollingElement.scrollTop,A=z.parentNode.getAttribute('data-id'),g(STATUS.LOADING);var C=z.innerText;l(A,C)}}),a('backBtn').addEventListener('click',function(){g(STATUS.LISTVIEW),c('detailMsg'),scrollTo(0,scrollTop)}),a('keyWord').addEventListener('keyup',function(y){''===y.target.value?c('clearBtn'):b('clearBtn'),13===y.keyCode&&(d('moreBtn'),b('dataLoading'),c('articles'),''===y.target.value?(k(),c('dataLoading'),b('articles')):u(y.target.value))}),a('searchBtn').addEventListener('click',function(y){if(''!==y.target.value){const z=a('keyWord').value;d('moreBtn'),b('dataLoading'),c('articles'),''===z?k():u(z)}}),a('clearBtn').addEventListener('click',function(){a('keyWord').value='',c('clearBtn'),b('dataLoading'),c('articles'),k()}),a('moreBtn').addEventListener('click',function(y){if(!y.target.classList.contains('disabled')){b('dataLoading'),scrollTo(0,window.document.body.offsetHeight);var z=encodeURI(x._getItem(x.CONSTANTS.INSTANCE_URL)+nextPageUrl);t(z,function(A,B){if(200===A){var C=B.articles;nextPageUrl=B.nextPageUrl,nextPageUrl||d('moreBtn'),c('dataLoading'),n(C)}else if(B){var D=B[0];console.log(D.message)}})}}),a('insertBtn').addEventListener('click',function(y){y.target.classList.contains('disabled')||Comm100AgentConsoleAPI.do('agentconsole.currentChat.input',createTextVersion(selectedArticleContent))})}function t(y,z){var A=new XMLHttpRequest;A.open('GET',y,!0),A.setRequestHeader('Authorization','Bearer '+x._getItem(x.CONSTANTS.ACCESS_TOKEN)),A.setRequestHeader('Accept','application/json'),A.setRequestHeader('Content-Type','application/json; charset=utf-8'),A.setRequestHeader('Accept-Language','en-US'),A.onreadystatechange=function(){4===this.readyState&&(0===this.status?(x._resetLogin(),g(STATUS.LOGIN)):'function'==typeof z&&z(this.status,JSON.parse(this.response)))},A.send()}function u(y){var z=x._getItem(x.CONSTANTS.INSTANCE_URL)+`/services/data/${restAPIVersion}/support/knowledgeArticles?`+encodeURI(`q=${y}`);t(z,function(A,B){if(200===A){var C=B.articles;nextPageUrl=B.nextPageUrl,nextPageUrl?f('moreBtn'):d('moreBtn'),m(C),g(STATUS.LISTVIEW),c('searchMsg'),b('articles'),c('dataLoading')}else 400===A&&v(B)})}function v(y){y[0]&&(a('searchMsg').innerHTML='INVALID_SEARCH'===y[0].errorCode?'Your search term must have 2 or more characters.':y[0].message,c('articles'),c('dataLoading'),b('searchMsg'))}function w(y,z,A){g(STATUS.DETAILVIEW),scrollTo(0,0),a('detailTitle').innerHTML=y,a('detailContent').innerHTML='',A[0]&&(a('detailMsg').innerHTML=A[0].message,b('detailMsg'))}var x=null;h()})();