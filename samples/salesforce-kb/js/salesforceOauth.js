var SFAuthContext=function(){'use strict';return SFAuthContext=function(a){if(this.CONSTANTS={ACCESS_TOKEN:'access_token',REFRESH_TOKEN:'refresh_token',INSTANCE_URL:'instance_url',ID:'id',SCOPE:'scope',TOKEN_TYPE:'token_type',SIGNATURE:'signature',ERROR:'',ERROR_DESCRIPTION:'',LOGIN_ERROR:'',POPUP_WIDTH:600,POPUP_HEIGHT:700},SFAuthContext.prototype._singletonInstance)return SFAuthContext.prototype._singletonInstance;if(SFAuthContext.prototype._singletonInstance=this,this.instance='https://login.salesforce.com/',this.config={},this.callback=null,this.popUp=!1,a.displayCall&&'function'!=typeof a.displayCall)throw new Error('displayCall is not a function');if(a.onError&&'function'!=typeof a.onError)throw new Error('onError is required, and it should be a function');if(!a.client_id)throw new Error('client_id is required');this.config=this._cloneConfig(a),void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0),this.config.popUp&&(this.popUp=!0),this.config.callback&&'function'==typeof this.config.callback&&(this.callback=this.config.callback),this.config.instance&&(this.instance=this.config.instance),this._getItem(this.CONSTANTS.ACCESS_TOKEN)||this._saveItem(this.CONSTANTS.ACCESS_TOKEN,''),this._getItem(this.CONSTANTS.INSTANCE_URL)||this._saveItem(this.CONSTANTS.INSTANCE_URL,''),this._getItem(this.CONSTANTS.REFRESH_TOKEN)||this._saveItem(this.CONSTANTS.REFRESH_TOKEN,''),this.loginUri='https://login.salesforce.com/services/oauth2/authorize?client_id='+this.config.client_id+'&response_type=token&redirect_uri='+encodeURIComponent(this.config.callback_url),this.config.redirectUri||(this.config.redirectUri=window.location.href.split('?')[0].split('#')[0]),this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split('?')[0].split('#')[0])},SFAuthContext.prototype.login=function(){this._saveItem(this.CONSTANTS.INSTANCE_URL,''),this._saveItem(this.CONSTANTS.ACCESS_TOKEN,''),this._saveItem(this.CONSTANTS.REFRESH_TOKEN,'');var b='https://login.salesforce.com/services/oauth2/authorize?client_id='+this.config.client_id+'&response_type=token&redirect_uri='+encodeURIComponent(this.config.callback_url);this.popUp&&this._loginPopup(b)},SFAuthContext.prototype._openPopup=function(a,b,c,d){try{var f=window.screenLeft?window.screenLeft:window.screenX,g=window.screenTop?window.screenTop:window.screenY,h=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,l=/\bElectron/g.test(navigator.userAgent)?window.parent.open:window.open,m=l(a,b,'width='+c+', height='+d+', top='+(i/2-d/2+g)+', left='+(h/2-c/2+f));return m.focus&&m.focus(),m}catch(n){return this.warn('Error opening popup, '+n.message),null}},SFAuthContext.prototype._loginPopup=function(a,b,c){var d=this._openPopup(a,'Salesforce Login',this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT);d.client_id=this.config.client_id,d.consumer_secret=this.config.consumer_secret,d.callback_url=this.config.callback_url;var f=c||this.callback;if(null==d)return this._saveItem(this.CONSTANTS.ERROR,'Error opening popup'),this._saveItem(this.CONSTANTS.ERROR_DESCRIPTION,'Popup Window is null. This can happen if you are using IE'),this._saveItem(this.CONSTANTS.LOGIN_ERROR,'Popup Window is null. This can happen if you are using IE'),b&&this._activeRenewals[b]&&(this._activeRenewals[b]=null),void(f&&f(this._getItem(this.CONSTANTS.ERROR_DESCRIPTION),null,this._getItem(this.CONSTANTS.ERROR)));var g=this,h=window.setInterval(function(){(!d||d.closed||void 0===d.closed)&&window.clearInterval(h);try{if(d.hash&&''!==d.hash||-1<d.location.indexOf('#')){var i=d.hash||d.location.substring(d.location.indexOf('#')+1);g.handleWindowCallback(i),window.clearInterval(h),d.close()}}catch(j){}},10)},SFAuthContext.prototype._resetLogin=function(){this._saveItem(this.CONSTANTS.INSTANCE_URL,''),this._saveItem(this.CONSTANTS.ACCESS_TOKEN,''),this._saveItem(this.CONSTANTS.REFRESH_TOKEN,'')},SFAuthContext.prototype._getHash=function(a){return-1<a.indexOf('#')&&(a=a.substring(1)),a},SFAuthContext.prototype._deserialize=function(a){var b,c=/\+/g,d=/([^&=]+)=([^&]*)/g,f=function(h){return decodeURIComponent(h.replace(c,' '))},g={};for(b=d.exec(a);b;)g[f(b[1])]=f(b[2]),b=d.exec(a);return g},SFAuthContext.prototype.isCallback=function(a){a=this._getHash(a);var b=this._deserialize(a);return b.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||b.hasOwnProperty(this.CONSTANTS.INSTANCE_URL)||b.hasOwnProperty(this.CONSTANTS.REFRESH_TOKEN)},SFAuthContext.prototype.handleWindowCallback=function(a){if(null==a&&(a=window.location.hash),this.isCallback(a)){var b=this.getRequestInfo(a);this.saveTokenFromHash(b);var c=null,d=null;d=this.callback,c=b.parameters[this.CONSTANTS.ACCESS_TOKEN];try{d&&d()}catch(f){console.error('Error occurred in user defined callback function',f)}this.popUp||(window.location.hash='',this.config.navigateToLoginRequestUrl&&(window.location.href=this._getItem(this.CONSTANTS.LOGIN_REQUEST)))}},SFAuthContext.prototype.getRequestInfo=function(a){a=this._getHash(a);var b=this._deserialize(a),c={valid:!1,parameters:{},stateResponse:''};return b&&(c.parameters=b,b.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||b.hasOwnProperty(this.CONSTANTS.INSTANCE_URL)||b.hasOwnProperty(this.CONSTANTS.REFRESH_TOKEN))?(c.valid=!0,c):c},SFAuthContext.prototype.saveTokenFromHash=function(a){a.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)?(this.info('Error :'+a.parameters.error+'; Error description:'+a.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.ERROR,a.parameters.error),this._saveItem(this.CONSTANTS.ERROR_DESCRIPTION,a.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),a.requestType===this.REQUEST_TYPE.LOGIN&&(this._saveItem(this.CONSTANTS.ACCESS_TOKEN,a.parameters.access_token),this._saveItem(this.CONSTANTS.INSTANCE_URL,a.parameters.instance_url),this._saveItem(this.CONSTANTS.REFRESH_TOKEN,a.parameters.refresh_token))):(this._saveItem(this.CONSTANTS.ACCESS_TOKEN,a.parameters.access_token),this._saveItem(this.CONSTANTS.INSTANCE_URL,a.parameters.instance_url),this._saveItem(this.CONSTANTS.REFRESH_TOKEN,a.parameters.refresh_token))},SFAuthContext.prototype._cloneConfig=function(a){if(null===a||'object'!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},SFAuthContext.prototype._saveItem=function(a,b){return this._supportsSessionStorage()?(sessionStorage.setItem(a,b),!0):(this.info('Session storage is not supported'),!1)},SFAuthContext.prototype._getItem=function(a){return this._supportsSessionStorage()?sessionStorage.getItem(a):(this.info('Session storage is not supported'),null)},SFAuthContext.prototype._removeItem=function(a){return this._supportsSessionStorage()?(sessionStorage.removeItem(a),!0):(this.info('Session storage is not supported'),!1)},SFAuthContext.prototype._supportsSessionStorage=function(){try{return!!window.sessionStorage&&(window.sessionStorage.setItem('storageTest','A'),'A'==window.sessionStorage.getItem('storageTest'))&&(window.sessionStorage.removeItem('storageTest'),!window.sessionStorage.getItem('storageTest'))}catch(a){return!1}},'undefined'!=typeof module&&module.exports&&(module.exports=SFAuthContext,module.exports.inject=function(a){return new SFAuthContext(a)}),SFAuthContext}();